<template>
  <div>
    <h2>DICOM Loader to Volume</h2>
    <p>
      This example shows how to load Dicom Files and convert into a VTK
      compatible volume.
    </p>
    <hr />
    <div>
      <input type="file" multiple ref="files" @change="handleFileUpload" />
    </div>
    <hr />
    <div v-if="loading">
      <h3>Loading...</h3>
    </div>
    <div v-else>
      <div class="row">
        <div class="col">
          <view-2d
            :volumes="volumes"
            :onCreated="this.saveComponentReference(0)"
            :painting="focusedWidgetId === 'PaintWidget'"
            :paint-filter-background-image-data="paintFilterBackgroundImageData"
          />
        </div>
        <div class="col">
          <view-2d
            :volumes="volumes"
            :onCreated="this.saveComponentReference(1)"
            :painting="focusedWidgetId === 'PaintWidget'"
            :paint-filter-background-image-data="paintFilterBackgroundImageData"
          />
        </div>
        <div class="col">
          <view-2d
            :volumes="volumes"
            :onCreated="this.saveComponentReference(2)"
            :painting="focusedWidgetId === 'PaintWidget'"
            :paint-filter-background-image-data="paintFilterBackgroundImageData"
          />
        </div>
        <div class="col">
          <view-3d
            :volumes="volumeRenderingVolumes"
            :onCreated="this.saveComponentReference(3)"
            :painting="focusedWidgetId === 'PaintWidget'"
            :paint-filter-background-image-data="paintFilterBackgroundImageData"
            :paintFilterLabelMapImageData="paintFilterLabelMapImageData"
          />
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import { View2D, View3D, vtkInteractorStyleMPRWindowLevel } from "@/library";

import vtkVolume from "vtk.js/Sources/Rendering/Core/Volume";
import vtkVolumeMapper from "vtk.js/Sources/Rendering/Core/VolumeMapper";

import vtkColorTransferFunction from "vtk.js/Sources/Rendering/Core/ColorTransferFunction";
import vtkPiecewiseFunction from "vtk.js/Sources/Common/DataModel/PiecewiseFunction";

import dicomLoader from "@/library/lib/data/dicomLoader.js";

const filesList = [
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000516.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000517.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000518.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000519.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000520.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000521.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000522.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000525.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000526.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000527.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000528.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000529.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000530.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000531.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000532.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000533.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000534.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000535.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000536.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000537.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000538.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000539.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000290.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000291.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000292.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000293.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000294.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000295.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000296.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000297.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000298.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000301.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000302.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000303.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000304.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000305.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000306.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000307.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000308.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000309.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000310.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000311.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000314.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000315.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000316.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000317.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000318.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000319.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000320.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000321.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000322.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000323.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000324.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000325.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000326.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000327.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000328.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000329.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000330.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000331.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000332.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000333.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000334.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000337.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000338.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000339.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000340.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000341.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000342.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000343.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000344.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000345.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000346.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000347.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000350.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000351.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000352.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000353.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000354.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000355.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000356.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000357.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000358.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000359.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000360.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000361.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000362.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000363.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000364.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000365.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000366.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000367.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000368.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000369.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000370.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000373.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000374.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000375.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000376.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000377.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000378.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000379.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000380.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000381.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000382.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000383.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000384.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000385.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000386.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000387.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000388.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000389.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000390.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000391.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000392.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000393.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000394.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000395.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000396.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000397.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000400.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000401.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000402.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000403.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000404.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000405.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000406.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000407.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000408.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000409.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000410.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000411.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000412.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000413.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000414.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000415.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000416.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000417.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000418.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000419.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000420.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000421.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000422.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000423.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000424.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000427.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000428.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000429.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000430.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000431.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000432.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000433.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000434.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000435.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000436.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000437.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000438.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000439.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000440.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000441.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000442.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000443.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000444.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000445.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000448.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000449.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000450.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000451.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000452.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000453.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000454.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000455.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000456.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000457.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000458.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000459.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000460.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000461.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000462.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000463.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000464.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000465.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000466.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000467.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000468.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000469.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000470.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000471.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000472.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000475.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000476.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000477.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000478.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000479.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000480.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000481.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000482.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000483.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000484.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000485.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000486.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000487.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000488.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000489.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000490.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000491.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000492.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000493.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000494.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000495.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000496.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000497.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000498.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000499.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000502.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000503.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000504.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000505.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000506.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000507.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000508.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000509.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000510.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000511.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000512.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000513.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000514.dcm",
  "./dicom1/1.3.12.2.1107.5.2.6.23586.30000019061016010362500000515.dcm"
];

export default {
  components: {
    "view-2d": View2D,
    "view-3d": View3D
  },
  data() {
    return {
      volumes: [],
      components: [],
      volumeRenderingVolumes: [],
      focusedWidgetId: null,
      paintFilterBackgroundImageData: null,
      paintFilterLabelMapImageData: null,
      threshold: 1500,
      loading: true
    };
  },
  created() {
    // non-reactive data
  },
  watch: {},
  methods: {
    handleFileUpload() {
      console.log(this.$refs.files.files);
      this.loadData(this.$refs.files.files);
    },
    saveComponentReference(viewportIndex) {
      return component => {
        this.components[viewportIndex] = component;

        const istyle = vtkInteractorStyleMPRWindowLevel.newInstance();
        const renderWindow = component.genericRenderWindow.getRenderWindow();

        switch (viewportIndex) {
          case 0:
            //Axial
            renderWindow.getInteractor().setInteractorStyle(istyle);
            istyle.setSliceNormal([0, 0, 1], [0, 1, 0]);
            istyle.setVolumeMapper(component.volumes[0]);
            break;
          case 1:
            // sagittal
            renderWindow.getInteractor().setInteractorStyle(istyle);
            istyle.setSliceNormal([1, 0, 0], [0, 0, -1]);
            istyle.setVolumeMapper(component.volumes[0]);
            break;
          case 2:
            // Coronal
            renderWindow.getInteractor().setInteractorStyle(istyle);
            istyle.setSliceNormal([0, 1, 0], [0, 0, -1]);
            istyle.setVolumeMapper(component.volumes[0]);
            break;
          default:
            break;
        }
      };
    },

    rerenderAllViewports() {
      // Update all render windows, since the automatic re-render might not
      // happen if the viewport is not currently using the painting widget
      Object.keys(this.components).forEach(viewportIndex => {
        const renderWindow = this.components[
          viewportIndex
        ].genericRenderWindow.getRenderWindow();

        renderWindow.render();
      });
    },

    loadData(files) {
      this.loading = true;

      const loader = dicomLoader.newInstance();
      console.log(loader);

      const volumeActor = vtkVolume.newInstance();
      const volumeMapper = vtkVolumeMapper.newInstance();

      volumeActor.setMapper(volumeMapper);

      loader.readFileSeries(files || filesList).then(data => {
        volumeMapper.setInputData(data);
        const rgbTransferFunction = volumeActor
          .getProperty()
          .getRGBTransferFunction(0);
        rgbTransferFunction.setMappingRange(500, 3000);

        const volumeRenderingActor = createVolumeRenderingActor(data);

        this.volumes = [volumeActor];
        this.volumeRenderingVolumes = [volumeRenderingActor];
        this.paintFilterBackgroundImageData = data;
        this.loading = false;
      });
    }
  },
  mounted() {
    this.loadData();
  }
};

function createVolumeRenderingActor(imageData) {
  const mapper = vtkVolumeMapper.newInstance();
  mapper.setInputData(imageData);
  mapper.setSampleDistance(1);

  const actor = vtkVolume.newInstance();
  actor.setMapper(mapper);

  const rgbTransferFunction = actor.getProperty().getRGBTransferFunction(0);
  const range = imageData
    .getPointData()
    .getScalars()
    .getRange();
  rgbTransferFunction.setMappingRange(range[0], range[1]);

  // create color and opacity transfer functions
  const cfun = vtkColorTransferFunction.newInstance();
  cfun.addRGBPoint(range[0], 0.4, 0.2, 0.0);
  cfun.addRGBPoint(range[1], 1.0, 1.0, 1.0);

  const ofun = vtkPiecewiseFunction.newInstance();
  ofun.addPoint(0.0, 0.0);
  ofun.addPoint(1000.0, 0.3);
  ofun.addPoint(6000.0, 0.9);

  actor.getProperty().setRGBTransferFunction(0, cfun);
  actor.getProperty().setScalarOpacity(0, ofun);
  actor.getProperty().setScalarOpacityUnitDistance(0, 4.5);
  actor.getProperty().setInterpolationTypeToLinear();
  actor.getProperty().setUseGradientOpacity(0, true);
  actor.getProperty().setGradientOpacityMinimumValue(0, 15);
  actor.getProperty().setGradientOpacityMinimumOpacity(0, 0.0);
  actor.getProperty().setGradientOpacityMaximumValue(0, 100);
  actor.getProperty().setGradientOpacityMaximumOpacity(0, 1.0);
  actor.getProperty().setAmbient(0.7);
  actor.getProperty().setDiffuse(0.7);
  actor.getProperty().setSpecular(0.3);
  actor.getProperty().setSpecularPower(8.0);

  return actor;
}
</script>

<style scoped>
.col {
  max-width: 400px;
}
</style>
